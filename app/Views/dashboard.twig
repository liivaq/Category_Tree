{% extends "layout.twig" %}
{% import 'components/section.twig' as sectionsTemplate %}

{% block content %}
    <div>
        <button id="showCreate"
                class="mb-6 bg-sky-600 hover:bg-sky-400 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            Add a new section
        </button>
        {% include 'sections/create.twig' %}
    </div>

    <div class="">
        {% macro renderSections(sections) %}
            {% for section in sections %}
                <div class="mx-auto bg-white p-8 border rounded shadow my-4">
                    <div id="viewmode-{{ section.getId() }}" class="view-mode">
                        <h2 class="font-semibold text-lg">{{ section.getTitle() }}</h2>
                        <p class="mb-4">{{ section.getDescription() }}</p>
                        <input type="hidden" value="{{ section.getId() }}"/>
                        <div class="space-x-4 flex">
                            <button
                                    data-target="{{ section.getId() }}"
                                    class="subsection-button bg-sky-600 hover:bg-sky-400 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                Show Subsections
                            </button>

                            <button
                                    data-target="{{ section.getId() }}"
                                    class="add-button bg-sky-600 hover:bg-sky-400 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                Add sub-section
                            </button>


                            <button
                                    data-target="{{ section.getId() }}"
                                    class="edit-button bg-amber-600 hover:bg-amber-400 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                Edit
                            </button>

                            <form action="/section/delete/{{ section.getId() }}" method="POST">
                                <button class="bg-red-600 hover:bg-red-400 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    Delete
                                </button>
                            </form>
                        </div>
                    </div>

                    <div id="editmode-{{ section.getId() }}" class="editing-mode hidden ">
                        <form class="my-4" action="/section/edit" method="POST">
                            <label for="editTitle" class="block text-gray-700 text-sm font-bold mb-2">Title</label>
                            <input
                                    class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    type="text"
                                    name="title"
                                    id="editTitle"
                                    value="{{ section.getTitle() }}">

                            <label for="editDescription"
                                   class="block text-gray-700 text-sm font-bold mb-2">Description</label>
                            <input
                                    class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    type="text"
                                    name="description"
                                    id="editDescription"
                                    value="{{ section.getDescription() }}">
                            <input type="hidden" name="id" value="{{ section.getId() }}">
                            <button
                                    class="bg-green-600 hover:bg-green-400 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                Save
                            </button>

                        </form>
                    </div>


                    <div class="mt-4">
                        <form id="addForm-{{ section.getId() }}" class="hidden" action="/section/add" method="POST">
                            <label for="title" class="block text-gray-700 text-sm font-bold mb-2">Title</label>
                            <input
                                    class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    id="title"
                                    name="title"
                                    type="text">
                            <label for="description"
                                   class="block text-gray-700 text-sm font-bold mb-2">Description</label>
                            <input
                                    class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    id="description"
                                    name="description"
                                    type="text">
                            <input type="hidden" name="parent_id" value="{{ section.id }}">
                            <button class="bg-green-600 hover:bg-green-400 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                Save
                            </button>
                        </form>
                    </div>
                </div>

                {% if section.getChildren() is not empty %}
                    <div id="section-{{ section.getId() }}" class="hidden ml-6">
                        {{ _self.renderSections(section.getChildren()) }}
                    </div>
                {% endif %}
            {% endfor %}
        {% endmacro %}

        {{ _self.renderSections(sections) }}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const showFormBtn = document.getElementById('showCreate');
            const myFormSection = document.getElementById('create');

            showFormBtn.addEventListener('click', function () {
                myFormSection.classList.toggle('hidden');
            });

            // Get all add buttons and add event listeners
            const addButtons = document.querySelectorAll('.add-button');
            addButtons.forEach(button => {
                button.addEventListener('click', function () {
                    // Toggle the visibility of the form section based on the data-target attribute
                    const targetFormId = this.getAttribute('data-target');
                    const formSection = document.getElementById('addForm-' + targetFormId);
                    formSection.classList.toggle('hidden');
                });
            });

            const subButtons = document.querySelectorAll('.subsection-button');
            subButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const targetSubId = this.getAttribute('data-target');
                    const subsectionContainer = document.getElementById('section-' + targetSubId);
                    subsectionContainer.classList.toggle('hidden');
                });
            });

            const editButtons = document.querySelectorAll('.edit-button');
            editButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const sectionId = this.getAttribute('data-target');
                    const viewMode = document.getElementById('viewmode-' + sectionId);
                    const editingMode = document.getElementById('editmode-' + sectionId);

                    viewMode.classList.toggle('hidden');
                    editingMode.classList.toggle('hidden');
                });
            });
        });
    </script>

{% endblock %}